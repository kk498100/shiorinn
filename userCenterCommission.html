<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>用户中心-佣金报表</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/datepicker.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
<body class="bg-f8">
    <!-- header -->
    <!--#include file ="./userCenterHead.html"-->
    <!-- user container -->
    <div class="g-container d-flex justify-content-between mx-auto user">
        <!-- left -->
        <!--#include file ="./aside.html"-->
        <!-- right -->
        <div class="g-content">
            <div class="carousel slide ident-top-carousel" data-ride="Carouse" id="identTopCarouse">
                <ol class="carousel-indicators">
                    <li data-target="#identTopCarouse" data-slide-to="0" class="active"></li>
                    <li data-target="#identTopCarouse" data-slide-to="1"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <a href="//lp.ls24k.com/active/lp_190605gg76w9hp.html" target="_blank"><img src="./images/up-img-top-banner1.png" class="w-100"></a>
                    </div>
                    <div class="carousel-item">
                        <a href="//www.ls24k.com/about.html" target="_blank"><img src="./images/up-img-top-banner2.png" class="w-100"></a>
                    </div>
                </div>
            </div>
            <div class="bg-ff recoed-main user-main">
                <strong class="recoed-main-top fz18 s-fcc09 d-block">佣金报表</strong>
                <div class="recoed-main-search d-flex justify-content-between align-self-center">
                    <div class="d-flex justify-content-start recoed-main-select position-relative">
                        <span class="text-center text-nowrap border col-10 justify-content-center border-right-0 s-fc66" sel_main>全部</span>
                        <span class="text-center col-2 justify-content-center position-relative border border-left-0" sel_icon_c><i sel_icon></i></span>
                        <ul class="w-100 position-absolute text-center border" sel_lis>
                            <li class="w-100 d-block">全部</li>
                            <li class="w-100 d-block">拉新奖励</li>
                            <li class="w-100 d-block">交易返佣</li>
                        </ul>
                    </div>
                    <div class="d-flex justify-content-start flex-nowrap search-sec">
                        <label class="s-fc66 text-nowrap align-self-center">是否结算：</label>
                        <div class="d-flex justify-content-start recoed-main-select position-relative">
                            <span class="text-center text-nowrap border col-10 justify-content-center border-right-0 s-fc66 d-flex" sel_main>全部</span>
                            <span class="text-center col-2 justify-content-center position-relative border border-left-0" sel_icon_c><i sel_icon></i></span>
                            <ul class="w-100 position-absolute text-center border" sel_lis>
                                <li class="w-100 d-block">全部</li>
                                <li class="w-100 d-block">是</li>
                                <li class="w-100 d-block">否</li>
                            </ul>
                        </div>
                    </div>
                    <div class="align-self-center commi-time d-flex justify-content-start">
                        <label class="s-fc66 align-self-center">邀请时间：</label>
                        <div class="c-datepicker-date-editor c-datepicker-single-editor J-datepicker-day align-self-center">
                            <input type="text" autocomplete="off" name="" placeholder="选择日期" class="c-datepicker-data-input only-date" aria-label="starTime">
                        </div>
                        <label class="s-fc66 align-self-center" style="margin:0 4px;">至</label>
                        <div class="c-datepicker-date-editor c-datepicker-single-editor J-datepicker-day align-self-center">
                            <input type="text" autocomplete="off" name="" placeholder="选择日期" class="c-datepicker-data-input only-date" aria-label="endTime">
                        </div>
                    </div>
                    <button class="btn text-white" type="button" id="searchBtn">查询</button>
                </div>
                <div class="d-flex justify-content-between user-commi">
                    <table class="w-100 text-center" id="commiTable"></table>
                </div>
                <div class="pages d-flex justify-content-center fz14" id="pages"></div>
            </div>
        </div>
    </div>
    <!-- footer -->
    <!--#include file ="./footer.html"-->

    <!-- server -->
    <!--#include file ="./userCenterServer.html"-->

    <script src="js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js" ></script>
    <script src="js/jquery.lazyload.min.js" ></script>
    <script src="./js/popup.js" ></script>
    <script src="./js/plugins/moment.min.js"></script>
    <script src="./js/datepicker.all.min.js"></script>
    <script src="./js/jq-paginator.min.js"></script>
    <script src="./js/jquery.cookie.js"></script>
    <script src="js/common.js"></script>
    <script src="js/userCenter.js"></script>
    <script>
        asideGuid(10);
        userCenterRecord();

        $(function(){
            render();
        })

        $("#searchBtn").on("click",throttle(reRender,1000));

        function throttle(fn,wait){
            var pre = 0;
            return function(){
                var method = this;
                var args = arguments;
                var now = Date.now();
                if(now - pre >= wait){
                    fn.apply(method, args);
                    pre = now;
                }
            };
        };

        function reRender(){
            var tidhtml = $(".recoed-main-search [sel_main]").html(), tid;
            if(tidhtml === "全部"){
                tid = 0;
            }else if(tidhtml === "拉新奖励"){
                tid = 1;
            }else{
                tid = 2;
            }
            var statusStr = $(".search-sec [sel_main]").html() , status;
            if(statusStr === "全部"){
                status = '';
            }else if(statusStr === "是"){
                status = 1;
            }else{
                status = 0;
            }
            var s_time = (new Date($(".recoed-main-search input[aria-label='starTime']").val() + " 00:00:00")).valueOf()/1000 || "";
            var e_time = (new Date($(".recoed-main-search input[aria-label='endTime']").val() + " 00:00:00")).valueOf()/1000 || "";
            render({
                s_time : s_time,
                e_time : e_time,
                type : tid,
                status:status
            });
        }

        function render(o){
            var d = {
                page : 1,
                size : 10,
                s_time : "",
                e_time :  "",
                type : 0,
                status:""
            }
            var o = $.extend(d,o);
            var res = $.ajaxMethod({url:"brokerage/brokerage_list",async:false,data:o});
            
            var $HTML = new Array();
            $HTML.push("<tr class='s-fcc09'><th>邀请时间</th><th>交易时间</th><th>交易账户</th><th>真实姓名</th><th>奖励类型</th><th>佣金（美元）</th><th>手数</th><th>是否结算</th><th>操作</th></tr>");
            if(res.data.list.length === 0 || !res){
                $HTML.push("<tr><td colspan='9'>查无记录！</td></tr>");
            }else{
                var len = res.data.list.length , i = len;
                for( len ; len-- ; ){
                    var j = i-len- 1, type , level , status;
                    switch(res.data.list[j].type){
                        case 1:
                            type ="拉新奖励";
                            break;
                        case 2:
                            type = "交易返佣";
                            break;
                    }
                    switch(res.data.list[j].level){
                        case 1:
                            level ="直接推荐";
                            break;
                        case 2:
                            level = "间接推荐";
                            break;
                    }
                    switch(res.data.list[j].status){
                        case 0:
                            status ="否";
                            break;
                        case 1:
                            status = "是";
                            break;
                    }
                    $HTML.push("<tr data-id='"+res.data.list[j].id+"'><td>"+ res.data.list[j].registertime +"</td>");
                    $HTML.push("<td>"+ res.data.list[j].trade_date +"</td>");
                    $HTML.push("<td>"+ res.data.list[j].username +"</td>");
                    $HTML.push("<td>"+ res.data.list[j].realname +"</td>");
                    $HTML.push("<td>"+ type +"</td>");
                    $HTML.push("<td>"+ res.data.list[j].realamount +"</td>");
                    $HTML.push("<td>"+ res.data.list[j].trade_num +"</td>");
                    $HTML.push("<td>"+ status +"</td>");
                    $HTML.push("<td>");
                    $HTML.push(res.data.list[j].type ===2 ?"<button class='btn text-white bg-c09a57' detailBtn>详情</button>":"");
                    $HTML.push("</td>");
                }
            }
            var str = $HTML.join("");
            $("#commiTable").html(str);
            var total = res.data.total , size = res.data.size;
            if(total > size){
                var totalPages = Math.ceil(total/size);
                $("#pages").jqPaginator({
                    totalPages: totalPages,  //总共多少页
                    visiblePages: 5, //最多显示分页数
                    currentPage: 1, // 初始显示第几页
                    first: '<a href="javascript:void(0);">首页<\/a>',
                    prev: '<a href="javascript:void(0);">上一页<\/a>',
                    next: '<a href="javascript:void(0);">下一页<\/a>',
                    last: '<a href="javascript:void(0);">尾页<\/a>',
                    page: '<a href="javascript:void(0);">{{page}}<\/a>',
                    onPageChange: function(n) {
                        var tid = $(".recoed-main-search [sel_main]").html() === "拉新奖励"?1:2;
                        var statusStr = $(".search-sec [sel_main]").html() , status;
                        if(statusStr === "全部"){
                            status = '';
                        }else if(statusStr === "是"){
                            status = 1;
                        }else{
                            status = 0;
                        }
                        var s_time =new Date($(".recoed-main-search input[aria-label='starTime']").val()).getTime()/1000 || "";
                        var e_time = new Date($(".recoed-main-search input[aria-label='endTime']").val()).getTime()/1000 || "";
                        render({
                            s_time : s_time,
                            e_time : e_time,
                            type : tid,
                            status:status,
                            page:n
                        });
                    }
                });
            }else{
                $("#pages").hide();
            }

            
            $("[detailBtn]").on("click",function(){
                var $LISHTML = new Array();
                var brokerage_id = $(this).parent().parent().attr("data-id");
                var lisres = $.ajaxMethod({url:"brokerage/brokerage_detail",async:false,data:{"brokerage_id":brokerage_id}});
                $LISHTML.push("<table><tr><th>序号</th><th>时间</th><th>手数</th></tr>");
                if(lisres.data.list.length === 0 || !lisres){
                    $HTML.push("<tr><td colspan='3'>查无记录！</td></tr>");
                }else{
                    var len = lisres.data.list.length, i = len;
                    for( len ; len-- ; ){
                        var j = i - len - 1;
                        $LISHTML.push("<tr><td>"+(j+1)+"</td>");
                        $LISHTML.push("<td>"+lisres.data.list[j].closetime_text+"</td>");
                        $LISHTML.push("<td>"+lisres.data.list[j].num+"</td></tr>");
                    }
                }
                $LISHTML.push("</table>");
                var str = $LISHTML.join("");
                $.popupMethod({
                    title:"详情",
                    style:"record-pop",
                    content:str
                });
            });
        };


    </script>
    <script type="text/javascript">
        $(function(){
            //年月日单个
            $('.J-datepicker-day').datePicker({
              hasShortcut: true,
              format:'YYYY-MM-DD',
              max:formatDate(new Date()),
              shortcutOptions: [{
                name: '今天',
                day: '0'
              }, {
                name: '昨天',
                day: '-1'
              }, {
                name: '一周前',
                day: '-7'
              }]
            });
        });
      </script>
</body>
</html>